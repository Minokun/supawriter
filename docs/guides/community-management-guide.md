# 社区管理功能使用指南

## 功能概述

社区管理页面提供了完整的文章数据库管理功能，包括：
- 📤 **一键发布**：将本地文章同步到PostgreSQL数据库
- 📊 **文章管理**：查询、搜索和删除数据库中的文章

## 功能入口

在应用侧边栏 → **用户** → **社区管理**

---

## 📤 一键发布功能

### 功能说明
将本地历史记录中的文章批量同步到PostgreSQL数据库，方便团队协作和云端备份。

### 使用步骤

#### 1. 检查同步状态
点击 **🔍 检查同步状态** 按钮，系统会：
- 扫描本地所有历史文章
- 查询数据库中已有的文章
- 显示同步统计（总数、已同步、未同步）

#### 2. 选择要发布的文章
- **单选**：勾选要发布的文章
- **全选**：使用 **🎯 全选** 一次性选择所有未同步的文章

#### 3. 发布文章
1. 确认已选择要发布的文章
2. 点击 **🚀 发布选中文章** 按钮
3. 查看发布结果：
   - ✅ **新增**：成功插入的文章数量
   - ℹ️ **已存在**：跳过的重复文章
   - ❌ **失败**：同步失败的文章（含详细错误）

### 注意事项
- 同步时会保留原始创建时间
- 重复发布不会覆盖已有文章
- 本地文章不会被删除

---

## 📊 文章管理功能

### 功能说明
查询、搜索和管理PostgreSQL数据库中的文章。

### 使用步骤

#### 1. 查看文章列表
进入 **文章管理** 标签页，自动加载数据库中的文章列表。

#### 2. 搜索文章
1. 在搜索框输入关键词
2. 点击 **搜索** 按钮
3. 查看匹配结果

#### 3. 查看文章详情
点击文章条目展开详情，显示：
- 文章ID
- 模型信息（供应商、名称、写作模式）
- 标签
- 内容预览

#### 4. 删除文章
1. 在文章详情中点击 **🗑️ 删除** 按钮
2. 确认删除操作（点击 ✓ 确认或 ✗ 取消）
3. 删除成功后页面自动刷新

### 显示信息
文章列表显示：
- **ID**：数据库唯一标识
- **标题**：文章标题
- **创建时间**：文章发布时间
- **模型**：使用的AI模型
- **标签数**：文章标签数量

---

## 技术细节

### 同步判断逻辑
通过 **标题 + 创建日期** 判断文章是否已同步：
```
标识 = f"{文章标题}_{创建日期(YYYY-MM-DD)}"
```

### 数据格式转换
- **Tags字段**：自动将字符串转换为数组
  ```
  "AI,机器学习,深度学习" → ["AI", "机器学习", "深度学习"]
  ```
- **时间戳**：自动转换为datetime对象

### 重复处理
使用 `ON CONFLICT DO NOTHING` 优雅处理重复文章：
- 已存在的文章自动跳过
- 不会报错，不影响其他文章同步

---

## 常见问题

### Q: 提示"PostgreSQL数据库未启用"？
**A:** 需要在 `deployment/.env` 中配置数据库连接信息：
```env
DATABASE_URL=postgresql://user:password@host:port/database
POSTGRES_HOST=your_host
POSTGRES_PORT=5432
POSTGRES_DB=supawriter
POSTGRES_USER=supawriter
POSTGRES_PASSWORD=your_password
```

### Q: 文章同步失败怎么办？
**A:** 
1. 查看错误详情了解具体原因
2. 常见错误：
   - Tags格式问题（已自动修复）
   - 时间戳格式问题（已自动修复）
   - 数据库连接问题（检查配置）

### Q: 可以重复发布同一篇文章吗？
**A:** 可以，系统会自动识别重复文章并跳过，不会创建重复记录。

### Q: 删除数据库中的文章会影响本地历史记录吗？
**A:** 不会。数据库和本地历史记录是独立的，删除数据库文章不影响本地记录。

---

## 最佳实践

1. **定期同步**：建议定期将重要文章同步到数据库备份
2. **清理冗余**：使用搜索功能定位并删除不需要的文章
3. **团队协作**：通过数据库共享文章，实现团队协作
4. **数据安全**：定期备份PostgreSQL数据库

---

## 更新日志

### v1.0 (2025-11-17)
- ✅ 创建社区管理页面
- ✅ 实现一键发布功能
- ✅ 实现文章查询和删除功能
- ✅ 支持tags和时间戳自动格式转换
- ✅ 优雅处理重复文章
